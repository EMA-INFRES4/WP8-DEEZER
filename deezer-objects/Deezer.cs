using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Text;
using System.Threading.Tasks;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;

namespace deezer_objects
{
    public class Deezer
    {
        private string DeezerURL = "http://api.deezer.com/editorial/{0}/charts";

        public async void getTopTracks(int type, Action<TracksResponse> callback){
            //var data = await this.DoRequestAsync(string.Format(DeezerURL, type));
            //var resp = await client.DoRequestAsync("http://graph.facebook.com/microsoft");
            //string result = data.ReadToEnd();
            string result = "{\"tracks\":{\"data\":[{\"id\":67122778,\"title\":\"Vandaag\",\"link\":\"http:\\/\\/www.deezer.com\\/track\\/67122778\",\"duration\":323,\"preview\":\"http:\\/\\/cdn-preview-2.deezer.com\\/stream\\/2466355619ad4ac53120de58427d4acd-0.mp3\",\"artist\":{\"id\":4106348,\"name\":\"Bakermat\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/4106348\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/4106348\\/image\",\"radio\":false},\"album\":{\"id\":6564469,\"title\":\"Electro Lab 01\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/6564469\\/image\"},\"type\":\"track\"},{\"id\":66465550,\"title\":\"Watch Out For This (Bumaye) [feat. Busy Signal, The Flexican & FS Green]\",\"link\":\"http:\\/\\/www.deezer.com\\/track\\/66465550\",\"duration\":269,\"preview\":\"http:\\/\\/cdn-preview-6.deezer.com\\/stream\\/6652f2863cc14783829d87fe624cc187-2.mp3\",\"artist\":{\"id\":282118,\"name\":\"Major Lazer\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/282118\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/282118\\/image\",\"radio\":true},\"album\":{\"id\":6501363,\"title\":\"Free The Universe\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/6501363\\/image\"},\"type\":\"track\"},{\"id\":54519711,\"title\":\"Down The Road\",\"link\":\"http:\\/\\/www.deezer.com\\/track\\/54519711\",\"duration\":207,\"preview\":\"http:\\/\\/cdn-preview-1.deezer.com\\/stream\\/19596263100e73cf11ce2f15c254efb5-4.mp3\",\"artist\":{\"id\":1530634,\"name\":\"C2C\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/1530634\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/1530634\\/image\",\"radio\":true},\"album\":{\"id\":5302151,\"title\":\"Tetra\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/5302151\\/image\"},\"type\":\"track\"},{\"id\":54519761,\"title\":\"Happy\",\"link\":\"http:\\/\\/www.deezer.com\\/track\\/54519761\",\"duration\":235,\"preview\":\"http:\\/\\/cdn-preview-1.deezer.com\\/stream\\/1cbb915569f6fcab9dc821baecf9fbe2-3.mp3\",\"artist\":{\"id\":1530634,\"name\":\"C2C\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/1530634\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/1530634\\/image\",\"radio\":true},\"album\":{\"id\":5302151,\"title\":\"Tetra\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/5302151\\/image\"},\"type\":\"track\"},{\"id\":64920072,\"title\":\"Nightcall\",\"link\":\"http:\\/\\/www.deezer.com\\/track\\/64920072\",\"duration\":257,\"preview\":\"http:\\/\\/cdn-preview-b.deezer.com\\/stream\\/bfb801c16a2aa56605ec0b5f41c6a34e-0.mp3\",\"artist\":{\"id\":13358,\"name\":\"Kavinsky\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/13358\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/13358\\/image\",\"radio\":true},\"album\":{\"id\":6358418,\"title\":\"OutRun\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/6358418\\/image\"},\"type\":\"track\"},{\"id\":64920076,\"title\":\"Roadgame\",\"link\":\"http:\\/\\/www.deezer.com\\/track\\/64920076\",\"duration\":224,\"preview\":\"http:\\/\\/cdn-preview-9.deezer.com\\/stream\\/94abd635c93dd27ef2ae4f71c9891f2d-0.mp3\",\"artist\":{\"id\":13358,\"name\":\"Kavinsky\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/13358\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/13358\\/image\",\"radio\":true},\"album\":{\"id\":6358418,\"title\":\"OutRun\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/6358418\\/image\"},\"type\":\"track\"},{\"id\":15781392,\"title\":\"Bangarang (feat. Sirah)\",\"link\":\"http:\\/\\/www.deezer.com\\/track\\/15781392\",\"duration\":215,\"preview\":\"http:\\/\\/cdn-preview-c.deezer.com\\/stream\\/c1b5735598a105b7208ea3b078855ef8-1.mp3\",\"artist\":{\"id\":525643,\"name\":\"Skrillex\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/525643\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/525643\\/image\",\"radio\":true},\"album\":{\"id\":1457546,\"title\":\"Bangarang EP\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/1457546\\/image\"},\"type\":\"track\"},{\"id\":5351361,\"title\":\"Baby I'm Yours (feat. Irfrane)\",\"link\":\"http:\\/\\/www.deezer.com\\/track\\/5351361\",\"duration\":215,\"preview\":\"http:\\/\\/cdn-preview-6.deezer.com\\/stream\\/6725b75bc1bd9abff602170f907b1cf0-1.mp3\",\"artist\":{\"id\":289345,\"name\":\"Breakbot\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/289345\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/289345\\/image\",\"radio\":true},\"album\":{\"id\":490316,\"title\":\"Baby I'M Yours\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/490316\\/image\"},\"type\":\"track\"},{\"id\":66465554,\"title\":\"Bubble Butt (feat. Bruno Mars, Tyga & Mystic)\",\"link\":\"http:\\/\\/www.deezer.com\\/track\\/66465554\",\"duration\":227,\"preview\":\"http:\\/\\/cdn-preview-6.deezer.com\\/stream\\/69f539aa63903e4b219163b3b70fba68-1.mp3\",\"artist\":{\"id\":282118,\"name\":\"Major Lazer\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/282118\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/282118\\/image\",\"radio\":true},\"album\":{\"id\":6501363,\"title\":\"Free The Universe\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/6501363\\/image\"},\"type\":\"track\"},{\"id\":66465545,\"title\":\"Get Free (feat. Amber of Dirty Projectors)\",\"link\":\"http:\\/\\/www.deezer.com\\/track\\/66465545\",\"duration\":291,\"preview\":\"http:\\/\\/cdn-preview-0.deezer.com\\/stream\\/084ddfb631c3fdbd83fd86ba68e5f995-2.mp3\",\"artist\":{\"id\":282118,\"name\":\"Major Lazer\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/282118\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/282118\\/image\",\"radio\":true},\"album\":{\"id\":6501363,\"title\":\"Free The Universe\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/6501363\\/image\"},\"type\":\"track\"}]},\"albums\":{\"data\":[{\"id\":5302151,\"title\":\"Tetra\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/5302151\\/image\",\"artist\":{\"id\":1530634,\"name\":\"C2C\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/1530634\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/1530634\\/image\",\"radio\":true},\"type\":\"album\"},{\"id\":6501363,\"title\":\"Free The Universe\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/6501363\\/image\",\"artist\":{\"id\":282118,\"name\":\"Major Lazer\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/282118\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/282118\\/image\",\"radio\":true},\"type\":\"album\"},{\"id\":6564469,\"title\":\"Electro Lab 01\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/6564469\\/image\",\"artist\":{\"id\":5080,\"name\":\"Various Artists\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/5080\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/5080\\/image\",\"radio\":false},\"type\":\"album\"},{\"id\":6358418,\"title\":\"OutRun\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/6358418\\/image\",\"artist\":{\"id\":13358,\"name\":\"Kavinsky\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/13358\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/13358\\/image\",\"radio\":true},\"type\":\"album\"},{\"id\":7078964,\"title\":\"Matangi\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/7078964\\/image\",\"artist\":{\"id\":3878,\"name\":\"M.I.A.\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/3878\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/3878\\/image\",\"radio\":true},\"type\":\"album\"},{\"id\":6927139,\"title\":\"The Art Of Sampling\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/6927139\\/image\",\"artist\":{\"id\":3452,\"name\":\"Parov Stelar\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/3452\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/3452\\/image\",\"radio\":true},\"type\":\"album\"},{\"id\":6984760,\"title\":\"Aleph\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/6984760\\/image\",\"artist\":{\"id\":210977,\"name\":\"Gesaffelstein\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/210977\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/210977\\/image\",\"radio\":true},\"type\":\"album\"},{\"id\":1457546,\"title\":\"Bangarang EP\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/1457546\\/image\",\"artist\":{\"id\":525643,\"name\":\"Skrillex\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/525643\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/525643\\/image\",\"radio\":true},\"type\":\"album\"},{\"id\":7112602,\"title\":\"Flume: Deluxe Edition\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/7112602\\/image\",\"artist\":{\"id\":1164295,\"name\":\"Flume\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/1164295\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/1164295\\/image\",\"radio\":false},\"type\":\"album\"},{\"id\":7013491,\"title\":\"Head Up High\",\"cover\":\"http:\\/\\/api.deezer.com\\/album\\/7013491\\/image\",\"artist\":{\"id\":901,\"name\":\"Morcheeba\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/901\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/901\\/image\",\"radio\":true},\"type\":\"album\"}]},\"artists\":{\"data\":[{\"id\":1530634,\"name\":\"C2C\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/1530634\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/1530634\\/image\",\"radio\":true,\"type\":\"artist\"},{\"id\":282118,\"name\":\"Major Lazer\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/282118\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/282118\\/image\",\"radio\":true,\"type\":\"artist\"},{\"id\":4106348,\"name\":\"Bakermat\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/4106348\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/4106348\\/image\",\"radio\":false,\"type\":\"artist\"},{\"id\":13358,\"name\":\"Kavinsky\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/13358\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/13358\\/image\",\"radio\":true,\"type\":\"artist\"},{\"id\":3878,\"name\":\"M.I.A.\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/3878\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/3878\\/image\",\"radio\":true,\"type\":\"artist\"},{\"id\":3452,\"name\":\"Parov Stelar\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/3452\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/3452\\/image\",\"radio\":true,\"type\":\"artist\"},{\"id\":525643,\"name\":\"Skrillex\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/525643\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/525643\\/image\",\"radio\":true,\"type\":\"artist\"},{\"id\":13570,\"name\":\"Metronomy\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/13570\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/13570\\/image\",\"radio\":true,\"type\":\"artist\"},{\"id\":210977,\"name\":\"Gesaffelstein\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/210977\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/210977\\/image\",\"radio\":true,\"type\":\"artist\"},{\"id\":1164295,\"name\":\"Flume\",\"link\":\"http:\\/\\/www.deezer.com\\/artist\\/1164295\",\"picture\":\"http:\\/\\/api.deezer.com\\/artist\\/1164295\\/image\",\"radio\":false,\"type\":\"artist\"}]}}";
            System.Diagnostics.Debug.WriteLine(result);
            TracksResponse response = JsonConvert.DeserializeObject <TracksResponse>(result);
            callback(response);
        }

        private async Task<System.IO.TextReader> DoRequestAsync(WebRequest req)
        {
            var task = Task.Factory.FromAsync((cb, o) => ((HttpWebRequest)o).BeginGetResponse(cb, o), res => ((HttpWebRequest)res.AsyncState).EndGetResponse(res), req);
            var result = await task;
            var resp = result;
            var stream = resp.GetResponseStream();
            var sr = new System.IO.StreamReader(stream);
            return sr;
        }

        private async Task<System.IO.TextReader> DoRequestAsync(string url)
        {
            HttpWebRequest req = HttpWebRequest.CreateHttp(url);
            req.AllowReadStreamBuffering = true;
            var tr = await DoRequestAsync(req);
            return tr;
        }
    
    }
}
